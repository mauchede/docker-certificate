#!/bin/bash
set -ex
cd "$(dirname "$0")/.."

CA_C="${CA_C:-FR}"

CA_KEY_FILE="${CA_KEY_FILE:-certificates/ca-key.pem}"
if [ ! -f "${CA_KEY_FILE}" ] ; then
    openssl genrsa -out "${CA_KEY_FILE}" 2048
fi

CA_FILE="${CA_FILE:-certificates/ca.pem}"
if [ ! -f "${CA_FILE}" ] ; then
    openssl req -config /usr/lib/ssl/openssl.cnf -days 1825 -key "${CA_KEY_FILE}" -new -out "${CA_FILE}" -subj "/C=${CA_C}" -x509
fi

exit 0
